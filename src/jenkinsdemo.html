<html>
<head>
<style>
    #maindiv
    {
        color: white; 
        background-color: LightSlateGrey; 
        width: 590px;
        margin: auto;
        padding: 66px;
        border: 1px solid black; 
        border-radius: 8px;
    }
    input
    {
       border-radius: 2px;
       border: 1px solid black;  
    }
    fieldset{
	margin-right:60px;
   }
</style>
</head>
<body onload="addRow(); addRowOps();">
    <div id="maindiv">
	<div style="margin-left:20px;">
	   <label style="color:black">
            Project Name <input style="width: 340px; height: 25px; border-radius: 5px; border: 1px solid black;" id="job_name" type="text">
	   </label>
        </div>
	<br>
	<div id="appstack">
	    <fieldset>
	    <legend style="f3f3da">Application Stack</legend>
	    <table id="AppUrl">
	        <tbody id="addAppUrl-tbody" class="AppUrltbody"> </tbody>
	    </table>
	    </fieldset>
	</div>
	<br>
	<div id="opsstack">
	   <fieldset>
	   <legend style="color:f3f3da">Operations Stack</legend>
	   <table id="opsUrl">
		<tbody id="addOpsUrl-tbody" class="opsUrltbody"> </tbody>
	   </table>
	   </fieldset>
	</div>
	<br>
       	<div id="cluster">
	   <fieldset>
	   <legend style="color:f3f3da">Cluster</legend>
	   <label style="margin-left:40px; color:black">
	   Pipeline
	   <input style="height:25px; width:340px; border-radius:5px"; id="config_url" type="text" onfocusout="test(this.value, this.id)">
	   </label>
	   </fieldset>
	</div>
	<input style="width:470px;" placeholder="Enter or copy the src URL" oninput="updatedata();" id="src_url" type="hidden">
	<input style="width:470px;" id="config_url" type="hidden">
	<br>
	<div style="text-align:center">
	<label>
        <input style=" background-color: LightSteelBlue; height:40px; color:white;" type="button" id="jenkins_job_button" value="Configure Pipeline" onclick="createJenkinsBuild();">
        <input style="background-color: LightSteelBlue; height:40px; color:white;" type="button" id="jenkins_build_button" value="Build Pipeline" onclick="startBuild();">   
        </label>
	</div>
    </div>
<script>
function addRow()
{
   var tbody  = document.getElementById("addAppUrl-tbody");
   var rowPos = tbody.rows.length;
   var row = tbody.insertRow(rowPos);
   var cell1 = row.insertCell(0);
   var cell2 = row.insertCell(1);
   cell1.innerHTML = 'Compose File <input type="text" style="height:25px; width:340px; border-radius:5px;" id="src_url'+ rowPos+'" name="src_url'+ rowPos+'" value="" onfocusout="test(this.value, this.id)">';
   cell2.innerHTML = '<img title = "Add new row" style = "height:23px; width:24px; id = "addRow'+rowPos+'" name = "addRow'+rowPos+'" src = "http://icons.iconarchive.com/icons/iconsmind/outline/256/Add-icon.png" onclick = "addRow()" alt = "add new row">'; 
}

function addRowOps()
{
   var tbody  = document.getElementById("addOpsUrl-tbody");
   var rowPos = tbody.rows.length;
   var row = tbody.insertRow(rowPos);
   var cell1 = row.insertCell(0);
   var cell2 = row.insertCell(1);
   cell1.innerHTML = 'Compose File <input type="text" style="height:25px; width:340px; border-radius:5px;" id="ops_url'+ rowPos+'" name="ops_url'+ rowPos+'" value="" onfocusout="test(this.value, this.id)">';
   cell2.innerHTML = '<img title = "Add new row" style = "height:23px; width:24px; id = "addRowOps'+rowPos+'" name = "addRowOps'+rowPos+'" src = "http://icons.iconarchive.com/icons/iconsmind/outline/256/Add-icon.png" onclick = "addRowOps()" alt = "add new row">';
}

function test(val, id)
{
   if(val == ""){
     document.getElementById(id).style.border="1px solid red";
     return
   } 
   var newStrValue = new RegExp ( '/blob/' );
   if(newStrValue.test(val) == true){
      document.getElementById(id).style.border="1px solid green";
   } else {
      document.getElementById(id).style.border="1px solid red";
   }
}

var txtbx = document.getElementById("src_url").value;
var txtbxln = txtbx.length;
function updatedata()
{
    enableConfigureJob();
    return;
    var urlText = document.getElementById("src_url").value;
    var urlProtocol = urlText.split("//", 1);
    var urlElements = urlText.split("/"); 
    if((urlProtocol == "https:")||(urlProtocol == "http:"))
    {
        var pttnidx = urlText.indexOf("/blob/");
        var txtln = urlText.length;
        var txtsb = urlText.substring(pttnidx,txtln);
        var patterned = urlText.replace(txtsb,".git");
        if(pttnidx > 0)
        {
            var confType = document.getElementById("basic").checked ? "-basic": "-enterprise";
            document.getElementById("job_name").value = urlElements[4] + confType;
            document.getElementById("config_url").value = urlText.replace(txtsb, confType + ".git");
            enableConfigureJob();
            
        }
        else
        { 
	    document.getElementById("config_url").value= "";
            document.getElementById("job_name").value = ""; 
	    disableConfigureJob();
        }
        
    } 
    else
    { 
        document.getElementById("config_url").value= "";
        document.getElementById("job_name").value = ""; 
        disableConfigureJob();
    }

    if(txtbxln !== urlText.length){
         document.getElementById("jenkins_job_button").style.backgroundColor = "LightSteelBlue";
         document.getElementById("jenkins_job_button").value = "Configure Pipeline";  
    }
 
}


function enableConfigureJob() {
   document.getElementById("jenkins_job_button").disabled = false; 
   document.getElementById("jenkins_job_button").style.cursor = "pointer"; 
}  

function disableConfigureJob() {
   document.getElementById("jenkins_job_button").disabled = true; 
   document.getElementById("jenkins_job_button").style.cursor = ""; 
} 

function configure(config){
    if(config == 1){
        document.getElementById("jenkins_job_button").style.backgroundColor = "green";
        document.getElementById("jenkins_job_button").value = "Configured";
        disableConfigureJob();
        document.getElementById("jenkins_build_button").disabled = false;
        document.getElementById("jenkins_build_button").style.cursor = "pointer"; 
        return;
    
    }

    if(config == 0){
        document.getElementById("jenkins_job_button").style.backgroundColor = "red";
        document.getElementById("jenkins_job_button").value = "Error in Configuration";
    }
}

function createJenkinsBuild() {
    var noOfElements = document.getElementById("AppUrl").rows.length;
    var i=0;
    var srcURL="";
    for (i=0; i<noOfElements; i++) {
        var x = document.getElementById("src_url"+i).value;
	srcURL += (x+";");
    }

    var noOfRowsOps = document.getElementById("opsUrl").rows.length;
    var i=0;
    var opsURL="";
    for (i=0; i<noOfRowsOps; i++) {
        var x = document.getElementById("ops_url"+i).value;
	opsURL += (x+";");
    }

    var configURL  = document.getElementById("config_url").value;
    if(srcURL && configURL == "") {
    } else{
        console.log("Entering.. createJenkinsBuild()");
        var buildName  = document.getElementById("job_name").value;
        var jenkinsURL = location.href + "createJenkinsBuild?jobName=" + buildName 
                                   + "&configGitHubURL=" + configURL
                                   + "&appsCompose=" + srcURL
				   + "&opsCompose=" + opsURL;
    
        console.log(jenkinsURL);
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function()  {
           if (xhttp.readyState == 4 && xhttp.status == 200) {
               var res = xhttp.responseText;
               console.log("IN createJenkinsBuild(): " + res);
               configure(1);
             
           } else {
               console.log("IN createJenkinsBuild() ERROR [" + xhttp.readyState + "] : [" + xhttp.status + "]");
               configure(0);
               
           }
        };
    
        xhttp.open("GET", jenkinsURL, true);
        xhttp.send();				
        }
}

function startBuild() {
    var buildName = document.getElementById("job_name").value;
    var startBuildUrl = location.href + "startJenkinsBuild?jobName=" + buildName;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() 
    {
        if (xhttp.readyState == 4 && xhttp.status == 200) 
        {
            var res = xhttp.responseText;
            console.log(res);
                        
        } else {
            console.log("IN startBuild() ERROR [" + xhttp.readyState + "] : [" + xhttp.status + "]");
        }
    };
    
    xhttp.open("GET", startBuildUrl, true);
    xhttp.send();    
    
}
</script>    
</body>
</html>
